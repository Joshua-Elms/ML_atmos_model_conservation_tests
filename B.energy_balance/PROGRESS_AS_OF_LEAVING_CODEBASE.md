Hello! If you're reading this Josh, you've decided to come back and work on this project again. 

Let me describe the state of the project as of when you put it to rest, Friday 30 January 2026. 

There are four primary experiments: energy and mass conservation running in perturbed and unperturbed configurations. 

The unperturbed experiments are completed, and those plots can be found in your overleaf doc. I believe that the experiments which produced those plots can be found in your Obsidian work logs, too. Unperturbed is easy; just take some ERA5 IC and test the model to see whether it can conserve mass/energy over a few months. 

The perturbed experiments are the troublemakers. Based on commentary from Maria Molina in December, you and Travis realized that more work would be needed than simply adding 10% to MSLP/SP or 5K to temperatures, depending on the respective experiment. Those perturbations are the primary ones, but there are secondary, balancing perturbations required to keep the initial condition in hydrostatic, geostrophic, and hypsometric balance (ok the third one isn't normally called a balance, but it's applicable). You first experimented with allowing E3SM (which generates those secondary perturbations by default) to handle the heavy lifting, and simply regridded E3SM ICs to E2S standards for a set of runs. Those failed, though, probably either because of a bug in your conversion code or simply being too far out of distribution with both a different model and a strong perturbation applied. 

You then turned to the analytical perturbation technique that you and Travis originally discussed, which consists of actually solving those balanced equations for the secondary perturbations that should result from your primary ones. This looks simple for the energy experiment (just a thickness a.k.a. geopotential height adjustment in proportion to the mean temperature increase in that layer), but more complex for the mass experiment (geopotential heights and u/v winds modified). As of today, you have most of the perturbation code for the energy balance experiment written, including: A) a 1.download... file which takes care of the download/creation of the perturbation, and therefore allows you to skip the annoying front hook-style perturbations you tried previously, and B) a 2.run_experiment file which is pretty much ready for a line to be added which reads "load perturbation and add to initial condition before passing to inference function". These files can pretty much be copied to the mass conservation experiment, though you'll need to do more work defining the perturbation expressions for that one. So -- that's what you'll need to do! Finish writing out the perturbation code, make sure all the pieces fit together, and then do some nice long runs to make sure that you're seeing the expected behavior from the perturbation code and that the models are as stable as yopu would expect. 